{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_28-09f60431c551a5de2a8e447a3ef6fb1b4fd05c37",
  "solcVersion": "0.8.28",
  "solcLongVersion": "0.8.28+commit.7893614a",
  "userSourceNameMap": {
    "contracts/Factory.sol": "project/contracts/Factory.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "cancun",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/Factory.sol": {
        "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.28;\n\nimport './StandardEscrow.sol';\n\ncontract EscrowFactory {\n\n    uint256 public escrowCount;\n\n    mapping(uint256 => address) public escrows;\n\n    event EscrowCreated(uint256 indexed id, address escrow);\n\n    function createEscrow(\n      address freelancer,\n      uint256 totalMilestones,\n      uint256 milestoneAmount,\n      uint256 approvalTimeout\n    ) external payable returns (address) {\n      StandardEscrow escrow = new StandardEscrow{value: msg.value}(\n          msg.sender,\n          freelancer,\n          totalMilestones,\n          milestoneAmount,\n          approvalTimeout\n        );\n        escrows[escrowCount] = address(escrow);\n        emit EscrowCreated(escrowCount, address(escrow));\n\n        escrowCount++;\n        return address(escrow);\n      }\n}\n\n\n\n// Classwork  1: Milestone Payment Contract (Escrow v2)\n\n// Context\n// A client hires a freelancer and pays per milestone instead of all at once.\n\n// Roles\n// Client\n// Freelancer\n\n// Requirements\n\n// Client creates a job with:\n// freelancer address\n// total number of milestones\n// ETH per milestone\n\n\n// Client funds the contract upfront\n// Freelancer marks a milestone as completed\n// Client approves the milestone\n// Contract releases ETH per milestone\n\n\n// Once all milestones are paid, the contract is complete\n// Thought Questions\n// What happens if the client disappears?\n// Should the freelancer be able to cancel?\n// How do you prevent double payments?\n"
      },
      "project/contracts/StandardEscrow.sol": {
        "content": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.28;\n\ncontract StandardEscrow {\n\n    address public immutable client;\n    address public immutable freelancer;\n\n    uint256 public immutable totalMilestones;\n    uint256 public immutable milestoneAmount;\n    uint256 public immutable approvalTimeout;\n\n    uint256 public completedMilestones;\n    uint256 public releasedMilestones;\n    uint256 public lastCompletionTime;\n\n    enum Status {\n        ACTIVE,\n        COMPLETE\n    }\n\n    Status public status;\n\n    modifier onlyClient() {\n        require(msg.sender == client, \"Only client\");\n        _;\n    }\n\n    modifier onlyFreelancer() {\n        require(msg.sender == freelancer, \"Only freelancer\");\n        _;\n    }\n\n    constructor(\n        address _client,\n        address _freelancer,\n        uint256 _totalMilestones,\n        uint256 _milestoneAmount,\n        uint256 _approvalTimeout\n    ) payable {\n        require(msg.value == _totalMilestones * _milestoneAmount, \"Incorrect funding\");\n\n        client = _client;\n        freelancer = _freelancer;\n        totalMilestones = _totalMilestones;\n        milestoneAmount = _milestoneAmount;\n        approvalTimeout = _approvalTimeout;\n\n        status = Status.ACTIVE;\n    }\n\n    // Freelancer completes a milestone\n    function markMilestoneCompleted() external onlyFreelancer {\n        require(status == Status.ACTIVE, \"Not active\");\n        require(completedMilestones < totalMilestones, \"All completed\");\n\n        completedMilestones++;\n        lastCompletionTime = block.timestamp;\n    }\n\n    // Client approves and pays for one milestone\n    function approveMilestone() external onlyClient {\n        _releasePayment();\n    }\n\n    // Freelancer forces payment if client disappears\n    function claimTimeoutPayment() external onlyFreelancer {\n        require(\n            block.timestamp > lastCompletionTime + approvalTimeout,\n            \"Timeout not reached\"\n        );\n        _releasePayment();\n    }\n\n    // Internal payment logic (gas-efficient)\n    function _releasePayment() internal {\n        require(status == Status.ACTIVE, \"Not active\");\n        require(releasedMilestones < completedMilestones, \"Nothing to release\");\n\n        releasedMilestones++;\n        \n        (bool ok, ) = freelancer.call{value: milestoneAmount}(\"\");\n        require(ok, \"ETH transfer failed\");\n\n\n        if (releasedMilestones == totalMilestones) {\n            status = Status.COMPLETE;\n        }\n    }\n\n\n}\n\n"
      }
    }
  }
}